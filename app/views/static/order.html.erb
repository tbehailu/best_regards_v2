<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en" itemscope itemtype="http://schema.org/Product"> <!--<![endif]-->
<head>

  <!-- Meta tags & title /-->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>BestRegards</title>
  <meta name="description" content="." />
  <meta name="keywords" content="" />
  <meta name="author" content="humans.txt">

  <!-- Favicon /-->
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon" /> <!-- Favicon /-->

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <!-- Stylesheets /-->
  stylesheet_link_tag "gumby.css"
  stylesheet_link_tag "style.css"
  stylesheet_link_tag "component.css"
  stylesheet_link_tag "jquery.fileupload.css"

  javascript_include_tag "modernizr-2.6.2.min.js" <!-- Modernizr /-->
  
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script type='text/javascript' src='https://cdn.firebase.com/v0/firebase.js'></script>

<script>
$(document).ready(function() {
    console.log("Ready for Input!");
    var listRef = new Firebase('https://bestregards.firebaseio.com/');
    $("#next").click(function(){
    var fname = $("#fname").val();
    var lname = $("#lname").val();
    var email = $("#email").val();
    var addr = $("#addr").val();
    var addr2 = $("#addr2").val();
    var city = $("#city").val();
    var state = $("#state").val();
    var zip = $("#zip").val();
    var name = fname + " " + lname
    listRef.child(name).set({fname: fname, lname: lname, email: email, addr: addr, addr2: addr2, city: city, state: state, zip: zip});
    $("#confirm").empty().append("Contact Information Saved!");
    });
});

</script>
<script>

var lines = [];

// Thanks to: http://mounirmesselmeni.github.io/2012/11/20/javascript-csv/
function handleFiles(files) {
    // Check for the various File API support.
    if (window.FileReader) {
        // FileReader are supported.
        getAsText(files[0]);
    } else {
        alert('FileReader are not supported in this browser.');
    }
  }

  function getAsText(fileToRead) {
    var reader = new FileReader();
    // Read file into memory as UTF-8
    reader.readAsText(fileToRead);
    // Handle errors load
    reader.onload = loadHandler;
    reader.onerror = errorHandler;
  }

  function loadHandler(event) {
    var csv = event.target.result;
    processData(csv);
  }

  function processData(csv) {
      var allTextLines = csv.split(/[\r\n|\n]/);
      for (var i=0; i<allTextLines.length; i++) {
        if(i == 0) continue;

          var data = allTextLines[i].split(',');
              var tarr = [];
              for (var j=0; j<data.length; j++) {
                  tarr.push(data[j]);
              }
              lines.push(tarr);
      }

      $.ajax("/PostToMailLift.php", {
        type: "POST",
        data: {
            SenderName1:    $("#fname").val() + ' ' + $("#lname").val(),
            SenderAddress1: $("#addr").val(),
            SenderAddress2: $("#addr2").val(),
            SenderCity:     $("#city").val(),
            SenderState:    $("#state").val(),
            SenderZip:      $("#zip").val(),
            Recipients:     lines
        },
        success: function() {
            alert("All done, now get back to honeymooning!");
        },
        error: function() {
            alert("There was a problem...");
        }
      });
  }

  function errorHandler(evt) {
    if(evt.target.error.name == "NotReadableError") {
        alert("Cannot read file !");
    }
  }
</script>

</head>


<body>

<!-- NAVIGATION ############################################### -->


        <!-- Mobile Menu -->

        <div class="mobile-menu">
            <section id="collapse">
                <div class="row">
                    <div class="mobile-menu-inner">
                        <ul class="nav-mobile">
                         <li><a href="#">About</a></li>
                         <li><a href="#">Support</a></li>
                         <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                </div>
            </section>
            <a href="#" id="collapse-menu">
              <%= image_tag "menu.png" %>
            </a>
        </div>


        <!--  Menu -->


        <div class="cbp-af-header">
            <nav class="row">
                 <div id="logo"><a href="#">
                  <%= image_tag "logotop.png" %>
                </div>
                 <ul id="nav">
                     <li><a href="#">Contact</a></li>
                     <li><a href="#">Support</a></li>
                     <li><a href="#cbp-so-scroller">About</a></li>
                 </ul>
            </nav>
        </div>


<!-- END NAVIGATION ############################################### -->


<!-- HEADER ############################################### -->


<section>
    <div class="row text-right social-stuff">
        <!--  Facebook Share Button-->
        <!-- PUT HERE YOUR GENERATE CODE OF FACEBOOK BUTTON : developers.facebook.com/docs/reference/plugins/like/ -->
        <!-- Twitter Share Button -->
<!--         <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script> -->
</section>

<!-- END HEADER ############################################### -->

<!-- BEGIN CONTAINER ############################################### -->
<div id="container" class="container">
  <div id="cbp-so-scroller" class="cbp-so-scroller"> <!-- HERE IS THE DIV FOR SCROLLING EFFECT -->

<!-- SECTION THUMBS ############################################### -->


<section align="center" class="cbp-so-section thumbs">
    <div class="row">
       <div class="twelve columns centered">
          <h3>Estimated Time Savings</h3>
          <div class="hi-icon-wrap hi-icon-effect-9 hi-icon-effect-9b">
             How many cards do you have to write? <br>
             <input type="text" name="cards" id="cards"> cards
             <p id="hours"></p>
             <br>
             <p id="actual">Spend only <b>15 minutes</b> with <b>Best Regards</b>!</p>
             <br>
             <br>
             <p>
             <form action="" method="POST"  class="field">
                <script>
                   $(document).ready(function() {
                    console.log("Ready for Input!");
                    $("#cards").keyup(function(){
                        var cardcount = isPositiveInteger($("#cards").val()*7) ;
                        function isPositiveInteger(input) {
                            if(input) {
                           var out = +input;
                           if (input < 0) input = Math.abs(input);
                           if (input != ~~input) input = parseInt(input, 10);
                           if (input >= 60 && input < 4000) {
                             min = input % 60;
                             hour = Math.floor(input/60);
                             $("#hours").empty().append("Thats over ").append(hour).append(" hours ").append(min).append(" minutes").append(" writing cards!");
                           }
                           if (input > 15 && input/7 <= 25) {
                           var timesaved = (input) - 15;
                           var h = Math.floor(timesaved/60);
                           var m = timesaved%60;
                             if (h > 0 ) {
                                 $("#hours").empty().append("You will save ").append(h).append(" hours ").append(m).append(" minutes using <b>Best Regards</b>")};
                             if (h <= 0){ $("#hours").empty().append("You will save ").append(m).append(" minutes").append(" using <b>Best Regards</b>");}
                           }
                           if (input <= 15 ||(input > 25 && input < 60)) { $("#hours").empty().append("You will spend ").append(input).append(" minutes").append(" writing cards."); }
                           if (input >= 4000) {
                             $("#hours").empty().append("To write ").append(input/7).append(" cards ").append(" please email us").append("<a href=\"mailto:bestregards@gmail.com?Subject=We%20need%20a%20bunch%20of%20cards%20\"> here!</a>")};

                         }
                         else { $("#hours").empty().append("You see that field above? If you put a number (i.e., \"40\") I can tell you how much time you save with <b>Best Regards</b>"); }
                        }
                     });
                       $("#cards").keydown(function(){ $("#hours").empty() });
                   });
                </script>
             </form>
             </p>
          </div>
       </div>
    </div>

    <div class="row">

        <div class="twelve columns centered">

            <h3>Order</h3>

            <div class="hi-icon-wrap hi-icon-effect-9 hi-icon-effect-9b">

            <div class="field">
            <ul class="field">
                <div class="picker">
                    <select>
                        <option value="#" disabled>Confirm Your Card Style</option>
                        <option>Simple</option>
                        <option>Classic</option>
                        <option>Elegant</option>
                     </select>
                 </div>
            </ul>
                <form action="" method="POST"  class="field">
                    <p><input class="input" type="text" name="fname" id="fname" placeholder="First Name" /></p>
                    <p><input class="input" type="text" name="lname" id="lname" placeholder="Last Name" /></p>
                    <p><input class="input" type="text" name="email" id="email" placeholder="Email" /></p>
                    <p><input class="input" type="text" name="addr" id="addr" placeholder="Address" /></p>
                    <p><input class="input" type="text" name="addr2" id="addr2" placeholder="Address Line 2" /></p>
                    <p><input class="input" type="text" name="city" id="city" placeholder="City" /></p>
                    <p><input class="input" type="text" name="state" id="state" placeholder="State" /></p>
                    <p><input class="input" type="text" name="zip" id="zip" placeholder="Zip" /></p>
                    <br>
                    <button type="button" id="next">Save</button>
                    <p id="confirm"></p>

                <p>

                </p>
                </div>

                    <p class="lead">
                    <br> Download the CSV <a href="https://www.dropbox.com/s/b7rxekciik4txmb/CSV_Template.xlsx"><u><FONT COLOR = "#C0C0C0">Template</u></FONT></a>
                    <br> Complete with Contacts
                    <br> Save File as .csv
                    <br> Upload File

                    <br><br><br>
                    <input id="fileupload" type="file" name="files[]" onchange="handleFiles(this.files)" />

                    </p>

                   </div>


            </div>

        </div>

    </div>


        <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<!--
        <span class="btn btn-success fileinput-button">
            <i class="glyphicon glyphicon-plus"></i>
            The file input field used as target for the file upload widget
            <input id="fileupload" type="file" name="files[]" onchange="handleFiles(this.files)" />
        </span> -->

        <!-- Order Checkout Section -->
        <!--
          <script
            src="https://checkout.stripe.com/v2/checkout.js" class="stripe-button"
            data-key="pk_test_5AryWoQVyeu32dmGgV0CW9qd"
            data-amount="10000"
            data-name="Best Regards"
            data-description="Cards ($100.00)"
            data-image="/128x128.png">
          </script>
          -->

          <br>
        <%= form_tag charges_path do %>
            <article>
                <label class="amount">
                    <span>Amount: $1.00</span>
                </label>
            </article>

        <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
            data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
            data-description="A month's subscription"
            data-amount="100"></script>
        <% end %>

    </form>
        <br>
        <br>
        <!-- The global progress bar -->
        <div id="progress" class="progress">
            <div class="progress-bar progress-bar-success"></div>
        </div>
        <!-- The container for the uploaded files -->
        <div id="files" class="files"></div>
        <br>
                      </ul>
            </div>
        </div>
        </div>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
        <script src="js/vendor/jquery.ui.widget.js"></script>
        <!-- The Load Image plugin is included for the preview images and image resizing functionality -->
        <script src="http://blueimp.github.io/JavaScript-Load-Image/js/load-image.min.js"></script>
        <!-- The Canvas to Blob plugin is included for image resizing functionality -->
        <script src="http://blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js"></script>
        <!-- Bootstrap JS is not required, but included for the responsive demo navigation -->
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
        <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
        <script src="js/jquery.iframe-transport.js"></script>
        <!-- The basic File Upload plugin -->
        <script src="js/jquery.fileupload.js"></script>
        <!-- The File Upload processing plugin -->
        <script src="js/jquery.fileupload-process.js"></script>
        <!-- The File Upload image preview & resize plugin -->
        <script src="js/jquery.fileupload-image.js"></script>
        <!-- The File Upload audio preview plugin -->
        <script src="js/jquery.fileupload-audio.js"></script>
        <!-- The File Upload video preview plugin -->
        <script src="js/jquery.fileupload-video.js"></script>
        <!-- The File Upload validation plugin -->
        <script src="js/jquery.fileupload-validate.js"></script>
        <script>
        /*jslint unparam: true, regexp: true */
        /*global window, $ */
        $(function () {
        'use strict';
        // Change this to the location of your server-side upload handler:
        var url = window.location.hostname === 'blueimp.github.io' ?
                    '//jquery-file-upload.appspot.com/' : 'server/php/',
            uploadButton = $('<button/>')
                .addClass('btn btn-primary')
                .prop('disabled', true)
                .text('Processing...')
                .on('click', function () {
                    var $this = $(this),
                        data = $this.data();
                    $this
                        .off('click')
                        .text('Abort')
                        .on('click', function () {
                            $this.remove();
                            data.abort();
                        });
                    data.submit().always(function () {
                        $this.remove();
                    });
                });
        $('#fileupload').fileupload({
            url: url,
            dataType: 'json',
            autoUpload: false,
            acceptFileTypes: /(\.|\/)(gif|csv|jpe?g|png)$/i,
            maxFileSize: 5000000, // 5 MB
            // Enable image resizing, except for Android and Opera,
            // which actually support image resizing, but fail to
            // send Blob objects via XHR requests:
            disableImageResize: /Android(?!.*Chrome)|Opera/
                .test(window.navigator.userAgent),
            previewMaxWidth: 100,
            previewMaxHeight: 100,
            previewCrop: true
        }).on('fileuploadadd', function (e, data) {
            data.context = $('<div/>').appendTo('#files');
            $.each(data.files, function (index, file) {
                var node = $('<p/>')
                        .append($('<span/>').text(file.name));
                if (!index) {
                    node
                        .append('<br>')
                        .append(uploadButton.clone(true).data(data));
                }
                node.appendTo(data.context);
            });
        }).on('fileuploadprocessalways', function (e, data) {
            var index = data.index,
                file = data.files[index],
                node = $(data.context.children()[index]);
            if (file.preview) {
                node
                    .prepend('<br>')
                    .prepend(file.preview);
            }
            if (file.error) {
                node
                    .append('<br>')
                    .append($('<span class="text-danger"/>').text(file.error));
            }
            if (index + 1 === data.files.length) {
                data.context.find('button')
                    .text('Upload')
                    .prop('disabled', !!data.files.error);
            }
        }).on('fileuploadprogressall', function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .progress-bar').css(
                'width',
                progress + '%'
            );
        }).on('fileuploaddone', function (e, data) {
            $.each(data.result.files, function (index, file) {
                if (file.url) {
                    var link = $('<a>')
                        .attr('target', '_blank')
                        .prop('href', file.url);
                    $(data.context.children()[index])
                        .wrap(link);
                } else if (file.error) {
                    var error = $('<span class="text-danger"/>').text(file.error);
                    $(data.context.children()[index])
                        .append('<br>')
                        .append(error);
                }
            });
        }).on('fileuploadfail', function (e, data) {
            $.each(data.files, function (index, file) {
                var error = $('<span class="text-danger"/>').text('File upload failed.');
                $(data.context.children()[index])
                    .append('<br>')
                    .append(error);
            });
        }).prop('disabled', !$.support.fileInput)
            .parent().addClass($.support.fileInput ? undefined : 'disabled');
        });
        </script>

        </section>

<!-- END SECTION THUMBS ############################################### -->


<div id="footerSpacer"></div> <!-- USED FOR THE FIXED EFFECT : DON'T REMOVE -->


<!-- FOOTER SECTION ############################################### -->


<section id="footer">

    <div class="row">

        <!-- Text from left -->

        <div class="seven columns pull_left">

            <p>Â© 2013 Best Regards<br>Made with
              <%= image_tag "withlove.png" %>
              at <a href="http://angelhack.com">angelhack</a></p>

        </div>

        <!-- Footer Navigation -->

        <div class="five columns text-right social">


                 <ul id="navfirst">

                     <li><a href="#">Privacy</a></li>

                     <li><a href="#">Support</a></li>

                 </ul>

        </div>

    </div>

</section>


<!-- END FOOTER SECTION ############################################### -->


</div> <!-- end of container -->


  <!-- Grab Google CDN's jQuery, fall back to local if offline -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="js/jquery-1.9.1.min.js"><\/script>')</script>
  javascript_include_tag "main.js"
  javascript_include_tag "plugins.js"
  javascript_include_tag "cbpScroller.js"
  javascript_include_tag "classie.js"
  javascript_include_tag "jquery.scrollto.js"
  javascript_include_tag "jquery.parallax-1.1.3.js"
  javascript_include_tag "jquery.flexslider.js"


  <!-- Change UA-XXXXX-X to be your site's ID -->
  <!--<script>
    window._gaq = [['_setAccount','UAXXXXXXXX1'],['_trackPageview'],['_trackPageLoadTime']];
    Modernizr.load({
      load: ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js'
    });
  </script>  -->

  </body>

</html>
